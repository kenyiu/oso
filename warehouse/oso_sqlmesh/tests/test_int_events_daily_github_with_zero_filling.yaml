test_int_events_daily_github_with_zero_filling_basic:
  # Tests that zero-filling correctly fills missing days with zero values
  # while preserving existing non-zero values
  model: oso.int_events_daily__github_with_zero_filling
  vars:
    start_dt: 2024-01-01
    end_dt: 2024-01-05
  inputs:
    oso.int_events_daily__github:
      rows:
      - bucket_day: 2024-01-01
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 5
      - bucket_day: 2024-01-03
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 3
      - bucket_day: 2024-01-01
        from_artifact_id: user_2
        to_artifact_id: repo_2
        event_source: GITHUB
        event_type: ISSUE_OPENED
        amount: 1
    oso.int_first_last_commit_to_github_repository:
      rows:
      - artifact_id: repo_1
        first_commit_time: 2023-12-15 10:30:00
      - artifact_id: repo_2
        first_commit_time: 2023-11-01 14:20:00
  outputs:
    query:
      rows:
      # user_1 -> repo_1 COMMIT_CODE: filled for all 5 days
      - bucket_day: 2024-01-01
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 5.0
      - bucket_day: 2024-01-02
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 0.0
      - bucket_day: 2024-01-03
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 3.0
      - bucket_day: 2024-01-04
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 0.0
      - bucket_day: 2024-01-05
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 0.0
      # user_2 -> repo_2 ISSUE_OPENED: filled for all 5 days
      - bucket_day: 2024-01-01
        from_artifact_id: user_2
        to_artifact_id: repo_2
        event_source: GITHUB
        event_type: ISSUE_OPENED
        amount: 1.0
      - bucket_day: 2024-01-02
        from_artifact_id: user_2
        to_artifact_id: repo_2
        event_source: GITHUB
        event_type: ISSUE_OPENED
        amount: 0.0
      - bucket_day: 2024-01-03
        from_artifact_id: user_2
        to_artifact_id: repo_2
        event_source: GITHUB
        event_type: ISSUE_OPENED
        amount: 0.0
      - bucket_day: 2024-01-04
        from_artifact_id: user_2
        to_artifact_id: repo_2
        event_source: GITHUB
        event_type: ISSUE_OPENED
        amount: 0.0
      - bucket_day: 2024-01-05
        from_artifact_id: user_2
        to_artifact_id: repo_2
        event_source: GITHUB
        event_type: ISSUE_OPENED
        amount: 0.0

test_int_events_daily_github_with_zero_filling_after_first_commit:
  # Tests that zero-filling only occurs after the repository's first commit date
  model: oso.int_events_daily__github_with_zero_filling
  vars:
    start_dt: 2024-01-01
    end_dt: 2024-01-05
  inputs:
    oso.int_events_daily__github:
      rows:
      - bucket_day: 2024-01-03
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 5
    oso.int_first_last_commit_to_github_repository:
      rows:
      # Repository first commit is on 2024-01-02, so zero-fill should start from that date
      - artifact_id: repo_1
        first_commit_time: 2024-01-02 10:30:00
  outputs:
    query:
      rows:
      # No data for 2024-01-01 since it's before first commit
      - bucket_day: 2024-01-02
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 0.0
      - bucket_day: 2024-01-03
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 5.0
      - bucket_day: 2024-01-04
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 0.0
      - bucket_day: 2024-01-05
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 0.0

test_int_events_daily_github_with_zero_filling_no_first_commit:
  # Tests that repositories without first commit data are excluded
  model: oso.int_events_daily__github_with_zero_filling
  vars:
    start_dt: 2024-01-01
    end_dt: 2024-01-03
  inputs:
    oso.int_events_daily__github:
      rows:
      - bucket_day: 2024-01-01
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 5
    oso.int_first_last_commit_to_github_repository:
      rows: []  # No first commit data
  outputs:
    query:
      rows: []  # Should return no rows since repo has no first commit data

test_int_events_daily_github_with_zero_filling_multiple_event_types:
  # Tests zero-filling with multiple event types for the same artifact pair
  model: oso.int_events_daily__github_with_zero_filling
  vars:
    start_dt: 2024-01-01
    end_dt: 2024-01-03
  inputs:
    oso.int_events_daily__github:
      rows:
      - bucket_day: 2024-01-01
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 5
      - bucket_day: 2024-01-02
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: ISSUE_OPENED
        amount: 2
    oso.int_first_last_commit_to_github_repository:
      rows:
      - artifact_id: repo_1
        first_commit_time: 2023-12-01 10:30:00
  outputs:
    query:
      rows:
      # COMMIT_CODE events - zero-filled for missing days
      - bucket_day: 2024-01-01
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 5.0
      - bucket_day: 2024-01-02
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 0.0
      - bucket_day: 2024-01-03
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: COMMIT_CODE
        amount: 0.0
      # ISSUE_OPENED events - zero-filled for missing days
      - bucket_day: 2024-01-01
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: ISSUE_OPENED
        amount: 0.0
      - bucket_day: 2024-01-02
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: ISSUE_OPENED
        amount: 2.0
      - bucket_day: 2024-01-03
        from_artifact_id: user_1
        to_artifact_id: repo_1
        event_source: GITHUB
        event_type: ISSUE_OPENED
        amount: 0.0

test_int_events_daily_github_with_zero_filling_empty_input:
  # Tests behavior with no input events
  model: oso.int_events_daily__github_with_zero_filling
  vars:
    start_dt: 2024-01-01
    end_dt: 2024-01-03
  inputs:
    oso.int_events_daily__github:
      rows: []
    oso.int_first_last_commit_to_github_repository:
      rows:
      - artifact_id: repo_1
        first_commit_time: 2023-12-01 10:30:00
  outputs:
    query:
      rows: []  # No events to zero-fill
